{% extends "base.html" %}

{% block title %}Definir Nova Senha{% endblock title %}

{% block content %}
<main class="container mx-auto px-4 py-16 flex items-center justify-center min-h-[80vh]">
    <div class="card-ranieri bg-white p-8 md:p-12 rounded-3xl shadow-2xl border border-border-custom max-w-md w-full relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-primary to-secondary"></div>

        {% if validlink %}
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-surface border border-border-custom mb-4 shadow-sm">
                    <i class="fa-solid fa-lock-open text-2xl text-roxo1"></i>
                </div>
                <h2 class="text-2xl font-bold text-roxo1 tracking-tight uppercase">Definir Nova Senha</h2>
            </div>

            <div class="mb-8 text-center">
                <p class="text-text-main opacity-70 text-sm font-medium leading-relaxed">
                    Por favor, digite sua nova senha. Certifique-se de que a nova senha não seja muito parecida com as senhas anteriores.
                </p>
            </div>

            {% if form.non_field_errors %}
                <div class="p-4 rounded-xl bg-red-50 border border-red-100 mb-6 animate-in fade-in slide-in-from-top-2" role="alert">
                    {% for error in form.non_field_errors %}
                        <p class="text-[11px] font-bold text-red-600 uppercase tracking-tight">{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}

            <form method="POST" class="space-y-6">
                {% csrf_token %}

                <div class="form-group">
                    <label for="{{ form.new_password1.id_for_label }}" class="block text-[10px] font-black uppercase text-roxo1 mb-2 tracking-[0.15em]">
                        Nova Senha
                    </label>
                    {{ form.new_password1 }}
                    {% if form.new_password1.errors %}
                        {% for error in form.new_password1.errors %}
                            <p class="text-red-500 text-[9px] font-bold mt-1 uppercase tracking-tighter">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                    {% if form.new_password1.help_text %}
                        <p class="mt-2 text-[9px] text-gray-400 font-medium italic leading-relaxed">{{ form.new_password1.help_text|safe }}</p>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="{{ form.new_password2.id_for_label }}" class="block text-[10px] font-black uppercase text-roxo1 mb-2 tracking-[0.15em]">
                        Confirme a Nova Senha
                    </label>
                    {{ form.new_password2 }}
                    {% if form.new_password2.errors %}
                        {% for error in form.new_password2.errors %}
                            <p class="text-red-500 text-[9px] font-bold mt-1 uppercase tracking-tighter">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                </div>

                <div class="pt-2">
                    <button type="submit" class="btn-primary w-full py-5 shadow-2xl flex items-center justify-center gap-3 group">
                        <span class="text-xs font-black uppercase tracking-widest">Alterar Senha</span>
                        <i class="fa-solid fa-shield-check text-xs transition-transform group-hover:scale-110"></i>
                    </button>
                </div>
            </form>

        {% else %}
            {# Cenário de Link Inválido/Expirado #}
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-red-50 border border-red-100 mb-4 shadow-sm">
                    <i class="fa-solid fa-triangle-exclamation text-2xl text-red-500"></i>
                </div>
                <h2 class="text-2xl font-bold text-roxo1 tracking-tight uppercase">Erro de Redefinição</h2>
            </div>

            <div class="mb-8">
                <div class="p-4 rounded-xl bg-red-50 border border-red-100 text-center" role="alert">
                    <p class="text-sm font-bold text-red-700 leading-relaxed">
                        O link de redefinição de senha que você tentou usar é <span class="uppercase">inválido</span>, possivelmente porque já foi usado ou expirou.
                    </p>
                </div>
                <p class="text-center text-text-main opacity-70 text-sm font-medium mt-6">
                    Por favor, solicite uma nova redefinição de senha para prosseguir.
                </p>
            </div>

            <div class="pt-2">
                <a href="{% url 'users:password_reset' %}" class="w-full flex items-center justify-center gap-3 py-5 bg-white border-2 border-border-custom text-roxo1 rounded-2xl text-xs font-black uppercase tracking-widest hover:border-roxo1 transition-all">
                    Solicitar Nova Redefinição
                </a>
            </div>
        {% endif %}

    </div>
</main>
{% endblock content %}