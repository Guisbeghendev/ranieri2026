{% extends "base.html" %}
{% load static %}

{% block title %}
    {{ livro_titulo }} - Capítulo {{ capitulo_ordem }} de {{ total_capitulos }}
{% endblock title %}

{% block content %}

    <div class="section-alt">
        <div class="container">
            <h1 class="section-title">Projeto Coral Ranieri</h1>
            <p class="section-subtitle">{{ livro_titulo }} Interativo. Capítulo {{ capitulo_ordem }} de {{ total_capitulos }}</p>

            <div class="card mb-3">
                <div class="card-header">
                    <h2>{% if capitulo %}{{ capitulo.titulo }}{% else %}Nenhum Conteúdo Cadastrado{% endif %}</h2>
                </div>

                <div class="card-body">
                    <div class="chapter-content">
                        {% if capitulo %}
                            {{ capitulo.conteudo|safe }}
                        {% else %}
                            <p class="text-center text-muted">Ainda não há capítulos cadastrados para a História.</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            {% if capitulo and total_capitulos > 0 %}
                <div class="chapter-navigation mt-3 center">

                    {% if capitulo_anterior %}
                        <a href="{% url 'coral:historia_digital' %}?page={{ capitulo_anterior.capitulo_index_base_1 }}"
                           class="btn btn-back action-button mr-2"
                           id="btn-anterior">
                            &larr; Capítulo Anterior
                        </a>
                    {% else %}
                        <button class="btn btn-back is-disabled action-button mr-2" disabled>
                            &larr; Capítulo Anterior
                        </button>
                    {% endif %}

                    <div class="mx-auto"></div>

                    {% if proximo_capitulo %}
                        <a href="{% url 'coral:historia_digital' %}?page={{ proximo_capitulo.capitulo_index_base_1 }}"
                           class="btn btn-secondary primary-action action-button ml-2"
                           id="btn-proximo">
                            Próximo Capítulo &rarr;
                        </a>
                    {% else %}
                        <button class="btn btn-secondary is-disabled action-button ml-2" disabled>
                            Fim da Narrativa
                        </button>
                    {% endif %}

                </div>

                <div class="text-center mt-3">
                    <a href="{% url 'coral:repertorio_list' %}" class="btn-secondary-custom">
                        <i class="fas fa-music"></i> Ver Repertório
                    </a>
                </div>

                <div class="progress-bar-container mt-3">
                    {% widthratio capitulo_ordem total_capitulos 100 as progresso_percentual %}
                    <div class="progress-bar-label text-center mb-1">
                        Progresso: {{ progresso_percentual|floatformat:0 }}%
                    </div>
                    <div class="progress-bar">
                        <div class="progress-bar-fill" style="width: {{ progresso_percentual }}%;"></div>
                    </div>
                </div>
            {% endif %}

        </div>
    </div>

{% endblock content %}

{% block js %}
    <script src="{% static 'coral/js/livro_digital_coral.js' %}"></script>
{% endblock js %}