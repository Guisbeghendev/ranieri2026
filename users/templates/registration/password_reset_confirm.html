{% extends "base.html" %}

{% block title %}Definir Nova Senha{% endblock title %}

{% block content %}

<div class="reset-main">
    <div class="reset-box">

        {% if validlink %}
            <div class="text-center reset-header">
                {# Usando a classe padrão de títulos de forms de auth #}
                <h2 class="login-header-title">Definir Nova Senha</h2>
            </div>

            <div class="reset-body mb-3">
                <p>
                    Por favor, digite sua nova senha. Certifique-se de que a nova senha não seja muito parecida com as senhas anteriores.
                </p>
            </div>

            {% if form.non_field_errors %}
                <div class="alert-danger mb-2" role="alert">
                    {% for error in form.non_field_errors %}
                        <p class="form-error">{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}

            <form method="POST">
                {% csrf_token %}

                <div class="form-group">
                    <label for="{{ form.new_password1.id_for_label }}" class="form-label">
                        Nova Senha
                    </label>
                    {{ form.new_password1 }}
                    {% if form.new_password1.errors %}
                        {% for error in form.new_password1.errors %}
                            <p class="form-error">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                    {% if form.new_password1.help_text %}
                        <span class="form-help">{{ form.new_password1.help_text|safe }}</span>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="{{ form.new_password2.id_for_label }}" class="form-label">
                        Confirme a Nova Senha
                    </label>
                    {{ form.new_password2 }}
                    {% if form.new_password2.errors %}
                        {% for error in form.new_password2.errors %}
                            <p class="form-error">{{ error }}</p>
                        {% endfor %}
                    {% endif %}
                </div>

                <button
                    type="submit"
                    class="btn btn-primary action-button mt-3" {# Usando action-button para largura 100% #}
                >
                    Alterar Senha
                </button>
            </form>

        {% else %}
            {# Cenário de Link Inválido/Expirado #}
            <div class="text-center reset-header">
                <h2 class="login-header-title">Erro de Redefinição</h2>
            </div>

            <div class="reset-body mb-3">
                <div class="alert-danger mb-3" role="alert">
                    <p>
                        O link de redefinição de senha que você tentou usar é **inválido**, possivelmente porque já foi usado ou expirou.
                    </p>
                </div>
                <p>
                    Por favor, solicite uma nova redefinição de senha.
                </p>
            </div>

            <div class="text-center mt-3">
                <a href="{% url 'password_reset' %}" class="btn btn-secondary action-button">
                    Solicitar Nova Redefinição
                </a>
            </div>

        {% endif %}

    </div>
</div>
{% endblock content %}