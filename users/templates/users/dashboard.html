{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard - Bem-vindo(a), {{ user.first_name }}{% endblock title %}

{% block content %}
<main class="container mx-auto px-4 py-12 max-w-7xl">

    {# card boas vindas #}
    <div class="mb-10 flex flex-col md:flex-row md:items-end md:justify-between gap-6">
        <div>
            <h1 class="text-3xl md:text-4xl font-black text-roxo1 tracking-tight uppercase leading-tight">
                Bem-vindo(a), {{ user.first_name }}!
            </h1>
            <p class="text-text-main opacity-60 text-sm font-medium tracking-widest uppercase mt-2">
                Painel de Controle <span class="text-primary mx-2">|</span> {{ user.get_tipo_usuario_display }}
            </p>
        </div>
        <div class="hidden md:block">
            <span class="text-[10px] font-black text-gray-400 uppercase tracking-[0.3em]">Status: Conectado</span>
        </div>
    </div>
    {# fim card boas vindas #}

    {# card msgs #}
    {% if messages %}
        <div class="mb-8 space-y-2">
            {% for message in messages %}
                <div class="p-4 rounded-xl text-sm font-medium border bg-white shadow-sm animate-in fade-in slide-in-from-top-4 border-border-custom text-roxo1">
                    <i class="fa-solid fa-circle-info mr-2 text-primary"></i> {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}
    {# fim card msgs #}

    {# para admin aprovar users #}
    {% include 'users/includes/approval_section.html' %}

    {# grid principal #}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">

        {# card resumo profile #}
        <div class="card-ranieri bg-white rounded-3xl border border-border-custom shadow-sm overflow-hidden flex flex-col">
            <div class="p-6 border-b border-border-custom flex items-center gap-3 bg-surface/30">
                <i class="fa-solid fa-user-gear text-primary text-xs"></i>
                <h3 class="text-[10px] font-black text-roxo1 uppercase tracking-[0.2em]">Minha Conta</h3>
            </div>
            <div class="p-8 flex-grow space-y-4">
                <div>
                    <p class="text-[9px] font-black text-gray-400 uppercase tracking-widest mb-1">Identificação</p>
                    <p class="text-sm font-bold text-roxo1">@{{ user.username }}</p>
                </div>
                <div>
                    <p class="text-[9px] font-black text-gray-400 uppercase tracking-widest mb-1">E-mail Cadastrado</p>
                    <p class="text-sm font-bold text-roxo1 truncate">{{ user.email }}</p>
                </div>
            </div>
            <div class="p-6 bg-surface/30 border-t border-border-custom">
                <a href="{% url 'users:profile' %}" class="btn-primary py-3 w-full text-center block text-[9px] font-black uppercase tracking-widest">
                    Perfil Completo
                </a>
            </div>
        </div>
        {# fim card resumo profile #}

        {# card açoes rapidas #}
        <div class="card-ranieri bg-white rounded-3xl border border-border-custom shadow-sm overflow-hidden flex flex-col">
            <div class="p-6 border-b border-border-custom flex items-center gap-3 bg-surface/30">
                <i class="fa-solid fa-bolt text-secondary text-xs"></i>
                <h3 class="text-[10px] font-black text-roxo1 uppercase tracking-[0.2em]">Ações Rápidas</h3>
            </div>
            <div class="p-8 flex-grow space-y-3">

                {# Painel Administrativo (Django Admin) #}
                {% if user.tipo_usuario == 'ADMIN' or user.is_superuser %}
                <a href="{% url 'admin:index' %}" target="_blank" class="flex items-center gap-4 p-4 rounded-2xl bg-primary/10 text-primary hover:bg-primary hover:text-white transition-all group border border-primary/20">
                    <i class="fa-solid fa-gauge-high text-xs"></i>
                    <span class="text-[10px] font-black uppercase tracking-widest">Painel Administrativo</span>
                </a>
                {% endif %}

                {# Painel do Fotógrafo (Repositório) #}
                {% if user.is_fotografo or user.is_fotografo_master or user.is_superuser %}
                <a href="{% url 'repositorio:gerenciar_galerias' %}" class="flex items-center gap-4 p-4 rounded-2xl bg-secondary/10 text-secondary hover:bg-secondary hover:text-roxo1 transition-all group border border-secondary/20">
                    <i class="fa-solid fa-camera text-xs"></i>
                    <span class="text-[10px] font-black uppercase tracking-widest">Painel do Fotógrafo</span>
                </a>
                {% endif %}

                <a href="{% url 'users:profile_edit' %}" class="flex items-center gap-4 p-4 rounded-2xl bg-surface hover:bg-roxo1 hover:text-white transition-all group border border-border-custom">
                    <i class="fa-solid fa-pen-to-square text-xs opacity-40 group-hover:opacity-100"></i>
                    <span class="text-[10px] font-black uppercase tracking-widest">Editar Dados</span>
                </a>
                <a href="{% url 'users:password_change' %}" class="flex items-center gap-4 p-4 rounded-2xl bg-surface hover:bg-roxo1 hover:text-white transition-all group border border-border-custom">
                    <i class="fa-solid fa-key text-xs opacity-40 group-hover:opacity-100"></i>
                    <span class="text-[10px] font-black uppercase tracking-widest">Alterar Senha</span>
                </a>
            </div>
        </div>
        {# fim card açoes rapidas #}

        {# card notificações #}
        <div class="card-ranieri bg-white rounded-3xl border border-border-custom shadow-sm overflow-hidden flex flex-col">
            <div class="p-6 border-b border-border-custom flex items-center gap-3 bg-surface/30">
                <i class="fa-solid fa-bell text-roxo1 text-xs"></i>
                <h3 class="text-[10px] font-black text-roxo1 uppercase tracking-[0.2em]">Notificações</h3>
            </div>
            <div class="p-8 flex-grow overflow-y-auto max-h-[250px] scrollbar-thin">
                {% if canais_nao_lidos %}
                    <div class="flex items-center gap-2 mb-4">
                        <span class="flex h-2 w-2 rounded-full bg-red-500 animate-ping"></span>
                        <p class="text-[10px] font-black text-red-500 uppercase tracking-widest">
                            {{ canais_nao_lidos|length }} Mensage{{ canais_nao_lidos|length|pluralize:"m,ns" }} pendente{{ canais_nao_lidos|length|pluralize:",s" }}
                        </p>
                    </div>
                    <div class="space-y-2">
                        {% for canal in canais_nao_lidos %}
                            <a href="{% url 'mensagens:canal_chat' slug=canal.slug %}" class="flex items-center justify-between p-3 rounded-xl bg-red-50 border border-red-100 group hover:bg-red-500 hover:text-white transition-all">
                                <span class="text-[10px] font-bold uppercase truncate">{{ canal.nome }}</span>
                                <i class="fa-solid fa-chevron-right text-[8px]"></i>
                            </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-6">
                        <i class="fa-solid fa-circle-check text-green-500 text-3xl mb-4"></i>
                        <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Tudo em dia!</p>
                    </div>
                {% endif %}
            </div>
            <div class="p-6 bg-surface/30 border-t border-border-custom">
                <a href="{% url 'mensagens:chat_list' %}" class="w-full block text-center py-3 border border-border-custom rounded-xl text-[9px] font-black uppercase text-roxo1 hover:bg-white transition-all">
                    Ver Todos os Canais
                </a>
            </div>
        </div>
        {# fim card notificações #}

    </div>
    {# fim grid principal #}

    {# grid oficial #}
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">

        {# card notificações #}
        <div class="card-ranieri bg-white rounded-3xl border border-border-custom shadow-sm overflow-hidden">
            <div class="p-6 border-b border-border-custom flex items-center justify-between bg-surface/30">
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-images text-primary text-xs"></i>
                    <h3 class="text-[10px] font-black text-roxo1 uppercase tracking-[0.2em]">Galerias Públicas</h3>
                </div>
                <span class="bg-primary/10 text-primary text-[8px] font-black px-2 py-1 rounded uppercase tracking-tighter">Novidades</span>
            </div>
            <div class="p-8">
                {% if ultimas_galerias_publicas %}
                    <div class="grid grid-cols-1 gap-4">
                        {% for galeria in ultimas_galerias_publicas %}
                            <a href="{% url 'galerias:detalhe_galeria' pk=galeria.pk %}" class="flex items-center gap-4 p-3 rounded-2xl hover:bg-surface transition-all border border-transparent hover:border-border-custom group">
                                <div class="w-16 h-16 rounded-xl overflow-hidden bg-gray-100 flex-shrink-0">
                                    {% if galeria.capa_proxy_url %}
                                        <img src="{{ galeria.capa_proxy_url }}" class="w-full h-full object-cover">
                                    {% else %}
                                        <div class="w-full h-full flex items-center justify-center"><i class="fa-solid fa-image text-gray-300"></i></div>
                                    {% endif %}
                                </div>
                                <div class="overflow-hidden">
                                    <h4 class="text-xs font-black text-roxo1 uppercase truncate tracking-tight group-hover:text-primary transition-colors">{{ galeria.nome }}</h4>
                                    <p class="text-[9px] font-bold text-gray-400 mt-1 uppercase">{{ galeria.data_do_evento|date:"d M Y" }}</p>
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-[10px] font-bold text-gray-400 uppercase text-center py-10">Nenhuma galeria pública disponível.</p>
                {% endif %}
            </div>
            <div class="p-6 border-t border-border-custom">
                <a href="{% url 'galerias:lista_galerias' %}" class="w-full block text-center py-3 text-[9px] font-black uppercase text-gray-400 hover:text-roxo1 transition-all">Ver Galerias Completa</a>
            </div>
        </div>
        {# fim card notificações #}

        {# card galerias #}
        <div class="card-ranieri bg-white rounded-3xl border border-border-custom shadow-sm overflow-hidden">
            <div class="p-6 border-b border-border-custom flex items-center gap-3 bg-surface/30">
                <i class="fa-solid fa-lock text-secondary text-xs"></i>
                <h3 class="text-[10px] font-black text-roxo1 uppercase tracking-[0.2em]">Galerias Exclusivas</h3>
            </div>
            <div class="p-8 max-h-[450px] overflow-y-auto scrollbar-thin">
                {% if grupos_com_galerias %}
                    {% for item in grupos_com_galerias %}
                        <div class="mb-8 last:mb-0">
                            <h4 class="text-[9px] font-black text-secondary uppercase tracking-[0.3em] mb-4 border-l-4 border-secondary pl-3">
                                {{ item.nome_grupo }}
                            </h4>
                            <div class="space-y-3">
                                {% for galeria in item.galerias %}
                                    <a href="{% url 'galerias:detalhe_galeria' pk=galeria.pk %}" class="flex items-center gap-4 p-3 rounded-2xl bg-surface/50 border border-border-custom hover:bg-white hover:shadow-lg transition-all group">
                                        <div class="w-12 h-12 rounded-lg overflow-hidden bg-gray-100 flex-shrink-0">
                                            {% if galeria.capa_proxy_url %}
                                                <img src="{{ galeria.capa_proxy_url }}" class="w-full h-full object-cover">
                                            {% else %}
                                                <div class="w-full h-full flex items-center justify-center"><i class="fa-solid fa-lock text-gray-300 text-[10px]"></i></div>
                                            {% endif %}
                                        </div>
                                        <div class="overflow-hidden">
                                            <h4 class="text-[10px] font-black text-roxo1 uppercase truncate group-hover:text-secondary transition-colors">{{ galeria.nome }}</h4>
                                            <p class="text-[8px] font-bold text-gray-400 mt-1">{{ galeria.data_do_evento|date:"d/m/Y" }}</p>
                                        </div>
                                    </a>
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="text-[10px] font-bold text-gray-400 uppercase text-center py-10">Sem galerias exclusivas no momento.</p>
                {% endif %}
            </div>
            <div class="p-6 border-t border-border-custom">
                <a href="{% url 'galerias:lista_galerias' %}" class="w-full block text-center py-3 text-[9px] font-black uppercase text-gray-400 hover:text-roxo1 transition-all">Ver Todas do Grupo</a>
            </div>
        </div>
        {# card galerias #}

    {# fim grid oficial #}
    </div>

    {# suporte e comunicação #}
    <div class="card-ranieri bg-gradient-to-r from-roxo1 to-roxo2 p-8 md:p-12 rounded-[2rem] text-white shadow-2xl relative overflow-hidden">
        <div class="absolute right-0 top-0 h-full w-1/3 opacity-10 flex items-center justify-center">
            <i class="fa-solid fa-headset text-[10rem] rotate-12"></i>
        </div>
        <div class="relative z-10 max-w-2xl">
            <h2 class="text-2xl md:text-3xl font-black uppercase tracking-tight mb-4 flex items-center gap-4">
                <span class="w-10 h-1 bg-secondary rounded-full"></span>
                Suporte e Ajuda
            </h2>
            <p class="text-white/70 font-medium text-sm md:text-base mb-8 leading-relaxed">
                Precisa de ajuda com o sistema ou encontrou um problema? Nossa equipe técnica está pronta para analisar sua solicitação.
            </p>
            <div class="flex flex-col sm:flex-row gap-4">
                <a href="{% url 'suporte:topico_create' %}" class="btn-primary bg-secondary border-none text-roxo1 hover:bg-white hover:scale-105 transition-all flex items-center justify-center gap-3 px-8">
                    <i class="fa-solid fa-ticket-alt"></i>
                    <span class="text-xs font-black uppercase tracking-widest">Abrir Chamado</span>
                </a>
                <a href="{% url 'suporte:topico_list' %}" class="flex items-center justify-center gap-3 px-8 py-4 rounded-2xl border-2 border-white/20 hover:border-white transition-all text-xs font-black uppercase tracking-widest text-white">
                    Meus Chamados
                </a>
            </div>
        </div>
    </div>
    {# fim suporte e comunicação #}

</main>
{% endblock content %}